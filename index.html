<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TechLift Africa — Training & Certification</title>
  <meta name="description" content="TechLift Africa: Courses, Trainings, Payments, Certificates" />
  <style>
    :root{--accent:#095cdb;--muted:#6b7280;--bg:#f6f8fb}
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,'Helvetica Neue',Arial;background:var(--bg);color:#111}
    header{background:#fff;border-bottom:1px solid #e6e9ef;padding:18px 32px;display:flex;align-items:center;justify-content:space-between}
    .brand{display:flex;gap:12px;align-items:center}
    .brand h1{margin:0;font-size:20px;color:var(--accent)}
    nav a{margin-left:14px;color:var(--muted);text-decoration:none}
    main{max-width:1200px;margin:28px auto;padding:0 20px}
    .grid{display:grid;grid-template-columns:1fr 320px;gap:20px}
    .card{background:#fff;padding:18px;border-radius:8px;box-shadow:0 6px 18px rgba(17,24,39,0.06)}
    .hero{display:flex;justify-content:space-between;gap:20px;align-items:center}
    .hero .left h2{margin:0 0 8px 0;font-size:26px}
    .hero .left p{margin:0;color:var(--muted)}
    .btn{display:inline-block;padding:10px 14px;border-radius:8px;background:var(--accent);color:#fff;text-decoration:none}
    .muted{color:var(--muted)}
    .list{display:flex;flex-direction:column;gap:10px}
    .course{display:flex;justify-content:space-between;align-items:center;padding:10px;border:1px solid #eef2ff;border-radius:8px}
    .small{font-size:13px}
    .form-row{display:flex;gap:10px}
    input,select,textarea{padding:10px;border-radius:6px;border:1px solid #d1d5db;width:100%}
    .roles{display:flex;gap:8px;flex-wrap:wrap}
    .chip{padding:6px 8px;border-radius:20px;background:#eef2ff;color:var(--accent);font-size:13px}
    footer{margin:40px 0 80px 0;text-align:center;color:var(--muted)}
    /* responsive */
    @media(max-width:980px){.grid{grid-template-columns:1fr}header{padding:14px} .hero{flex-direction:column;align-items:flex-start}}
    /* table */
    table{width:100%;border-collapse:collapse}
    th,td{padding:8px;border-bottom:1px solid #eef2ff;text-align:left}
    .right{text-align:right}
  </style>
  <!-- External libs (CDN) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    // We will use Web Crypto for hashing user passwords before saving to localStorage
    async function hashPassword(password, salt){
      const enc = new TextEncoder();
      const pw = enc.encode(password + salt);
      const hash = await crypto.subtle.digest('SHA-256', pw);
      return Array.from(new Uint8Array(hash)).map(b=>b.toString(16).padStart(2,'0')).join('');
    }
  </script>
</head>
<body>
  <header>
    <div class="brand">
      <svg width="44" height="44" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="6" fill="var(--accent)"/><path d="M6 14L10 10L14 14" stroke="#fff" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
      <div>
        <h1>TechLift Africa</h1>
        <div class="muted small">Skills · Training · Certification</div>
      </div>
    </div>
    <nav>
      <a href="#" id="nav-home">Home</a>
      <a href="#" id="nav-courses">Courses</a>
      <a href="#" id="nav-dashboard">Dashboard</a>
      <a href="#" id="nav-login" class="btn">Login / Register</a>
    </nav>
  </header>

  <main>
    <section class="hero card">
      <div class="left">
        <h2>Upskill with practical tech trainings — build a career</h2>
        <p class="muted">Self-paced courses, live trainings, and certificates trusted across the region.</p>
        <div style="margin-top:12px">
          <a class="btn" id="cta-register">Get Started</a>
          <a href="#" style="margin-left:12px" id="cta-browse" class="muted">Browse courses</a>
        </div>
      </div>
      <div class="right muted small">
        <div style="text-align:right">Available Trainings<br><span class="chip" id="total-courses">0 courses</span></div>
      </div>
    </section>

    <div class="grid" style="margin-top:20px">
      <section>
        <div class="card">
          <h3>Featured Courses</h3>
          <div id="courses-list" class="list" style="margin-top:12px">
            <!-- courses rendered here -->
          </div>
        </div>

        <div class="card" style="margin-top:18px">
          <h3>How it works</h3>
          <ol class="muted small">
            <li>Register as Student or Instructor.</li>
            <li>Enroll in courses and complete lessons.</li>
            <li>Receive an autogenerated certificate as PDF after completion.</li>
          </ol>
        </div>
      </section>

      <aside>
        <div class="card">
          <h4>Account</h4>
          <div id="account-area" style="margin-top:12px">
            <div id="guest-actions">
              <button id="open-login" class="btn">Login</button>
              <button id="open-register" style="margin-left:8px" class="btn">Register</button>
            </div>
            <div id="user-box" style="display:none">
              <div id="user-info" style="margin-bottom:10px"></div>
              <div style="display:flex;gap:8px">
                <button id="btn-dashboard" class="btn">Dashboard</button>
                <button id="btn-logout" style="background:#ef4444" class="btn">Logout</button>
              </div>
            </div>
          </div>
        </div>

        <div class="card" style="margin-top:14px">
          <h4>Quick Links</h4>
          <div style="margin-top:10px" class="roles">
            <div class="chip">Instructors</div>
            <div class="chip">Students</div>
            <div class="chip">Admin</div>
            <div class="chip">Accountant</div>
          </div>
        </div>
      </aside>
    </div>

    <!-- Dashboard / Modals -->
    <div id="modal-root"></div>

  </main>

  <footer>
    © TechLift Africa — Built with ❤️ — Local demo. Replace payment stubs with real API endpoints in production.
  </footer>

  <script>
    // ---------- Data layer using localStorage ----------
    const DB = {
      USERS_KEY: 'techlift_users_v1',
      COURSES_KEY: 'techlift_courses_v1',
      SESS_KEY: 'techlift_session_v1',
      TRANSACTIONS_KEY: 'techlift_tx_v1',
      CERTS_KEY: 'techlift_certs_v1'
    }

    // Initialize default admin if none exists
    async function ensureDefaults(){
      let users = JSON.parse(localStorage.getItem(DB.USERS_KEY) || '[]');
      if(!users.find(u=>u.role==='superadmin')){
        const salt = Date.now().toString();
        const hash = await hashPassword('Admin@123', salt);
        users.push({id:'u_1',name:'Super Admin',email:'admin@techlift.africa',role:'superadmin',salt,password:hash});
        localStorage.setItem(DB.USERS_KEY, JSON.stringify(users));
      }
      if(!localStorage.getItem(DB.COURSES_KEY)){
        const sample = [
          {id:'c_1',title:'Intro to Python',desc:'Beginner to Python programming',instructorId:null,lessons:[{id:'l1',title:'Setup',content:'Install Python and tools',completeBy:[]}]},
          {id:'c_2',title:'Web Development Basics',desc:'HTML, CSS & JS fundamentals',instructorId:null,lessons:[]}
        ];
        localStorage.setItem(DB.COURSES_KEY, JSON.stringify(sample));
      }
    }

    // ---------- Auth & Users ----------
    async function registerUser({name,email,password,role='student'}){
      const users = JSON.parse(localStorage.getItem(DB.USERS_KEY) || '[]');
      if(users.find(u=>u.email===email)) throw new Error('Email already registered');
      const id = 'u_'+(Date.now());
      const salt = Date.now().toString(36);
      const hash = await hashPassword(password, salt);
      const user = {id,name,email,role,salt,password:hash,createdAt:new Date().toISOString()};
      users.push(user); localStorage.setItem(DB.USERS_KEY, JSON.stringify(users));
      return user;
    }
    async function loginUser(email,password){
      const users = JSON.parse(localStorage.getItem(DB.USERS_KEY) || '[]');
      const u = users.find(x=>x.email===email);
      if(!u) throw new Error('No account with that email');
      const h = await hashPassword(password, u.salt);
      if(h !== u.password) throw new Error('Invalid credentials');
      const session = {userId:u.id,createdAt:new Date().toISOString()};
      localStorage.setItem(DB.SESS_KEY, JSON.stringify(session));
      return u;
    }
    function logout(){ localStorage.removeItem(DB.SESS_KEY); renderAccount(); }
    function currentUser(){
      const s = JSON.parse(localStorage.getItem(DB.SESS_KEY) || 'null');
      if(!s) return null; const users = JSON.parse(localStorage.getItem(DB.USERS_KEY)||'[]'); return users.find(u=>u.id===s.userId) || null;
    }

    // ---------- Courses ----------
    function getCourses(){ return JSON.parse(localStorage.getItem(DB.COURSES_KEY)||'[]'); }
    function saveCourses(c){ localStorage.setItem(DB.COURSES_KEY, JSON.stringify(c)); }
    function addCourse(course){ const cs=getCourses(); cs.unshift(course); saveCourses(cs); }
    function enrollCourse(userId, courseId){
      // store in transactions or per-user data
      const tx = JSON.parse(localStorage.getItem(DB.TRANSACTIONS_KEY)||'[]');
      tx.push({id:'tx_'+Date.now(),userId,courseId,type:'enroll',date:new Date().toISOString()});
      localStorage.setItem(DB.TRANSACTIONS_KEY, JSON.stringify(tx));
    }

    // ---------- Certificates ----------
    async function generateCertificate(user,course){
      // use jsPDF to generate simple PDF certificate
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({orientation:'landscape'});
      doc.setFontSize(28); doc.text('TechLift Africa', 20, 30);
      doc.setFontSize(16); doc.text('Certificate of Completion', 20, 50);
      doc.setFontSize(12); doc.text(`This certifies that ${user.name} has completed the course: ${course.title}`, 20, 70);
      doc.setFontSize(10); const certId = 'CERT-'+Date.now(); doc.text(`Certificate ID: ${certId}`, 20, 90);
      doc.text(`Date: ${new Date().toLocaleDateString()}`, 20, 100);
      const blob = doc.output('blob');
      const url = URL.createObjectURL(blob);
      // save cert metadata
      const certs = JSON.parse(localStorage.getItem(DB.CERTS_KEY)||'[]');
      certs.push({id:certId,userId:user.id,courseId:course.id,issuedAt:new Date().toISOString(),url});
      localStorage.setItem(DB.CERTS_KEY, JSON.stringify(certs));
      return {blob,url,meta:certs[certs.length-1]};
    }

    // ---------- Payments (Stubs / Mock) ----------
    // NOTE: Mobile money & Visa integrations must be done server-side in production.
    // We provide client-side stubs that simulate success and record a transaction.
    function mockPayment({method,userId,amount,phone}){
      const tx = JSON.parse(localStorage.getItem(DB.TRANSACTIONS_KEY)||'[]');
      const t = {id:'tx_'+Date.now(),method,userId,amount,phone,status:'success',date:new Date().toISOString()};
      tx.push(t); localStorage.setItem(DB.TRANSACTIONS_KEY, JSON.stringify(tx));
      return t;
    }

    // ---------- UI Rendering ----------
    async function renderCourses(){
      const list = document.getElementById('courses-list'); list.innerHTML='';
      const cs = getCourses();
      document.getElementById('total-courses').innerText = cs.length + ' courses';
      cs.forEach(c=>{
        const el = document.createElement('div'); el.className='course';
        el.innerHTML=`<div><strong>${c.title}</strong><div class='muted small'>${c.desc||''}</div></div>
          <div style='display:flex;gap:8px'>
            <button class='btn' onclick="viewCourse('${c.id}')">View</button>
            <button onclick="openEnroll('${c.id}')" class='btn'>Enroll</button>
          </div>`;
        list.appendChild(el);
      })
    }

    function viewCourse(id){
      const cs = getCourses(); const c = cs.find(x=>x.id===id);
      const modal = createModal(`<h3>${c.title}</h3><p>${c.desc||''}</p>
        <h4>Lessons</h4>
        ${c.lessons && c.lessons.length? '<ul>' + c.lessons.map(l=>`<li>${l.title} <button class=btn onclick="completeLesson('${id}','${l.id}')">Mark Complete</button></li>`).join('') + '</ul>' : '<p class="muted">No lessons yet</p>'}
        <div style='margin-top:12px'><button class='btn' onclick="startCourse('${id}')">Start / Continue</button></div>
      `, true);
      document.getElementById('modal-root').appendChild(modal);
    }

    function openEnroll(courseId){
      const u = currentUser();
      if(!u) return alert('Please login to enroll');
      enrollCourse(u.id, courseId);
      alert('Enrolled — payment step will be available in Dashboard.');
    }

    function createModal(html,closable=true){
      const c = document.createElement('div');
      c.className='modal card'; c.style.position='fixed'; c.style.left='50%'; c.style.top='50%'; c.style.transform='translate(-50%,-50%)'; c.style.zIndex='9999'; c.style.minWidth='320px';
      c.innerHTML = `<div style='display:flex;justify-content:space-between;align-items:center'><div></div>${closable?'<button id="close-modal" class="btn">Close</button>':''}</div><div style='margin-top:12px'>${html}</div>`;
      if(closable) c.querySelector('#close-modal').onclick = ()=>c.remove();
      return c;
    }

    // Dashboard rendering
    function renderAccount(){
      const u = currentUser();
      if(u){
        document.getElementById('guest-actions').style.display='none';
        document.getElementById('user-box').style.display='block';
        document.getElementById('user-info').innerHTML = `<strong>${u.name}</strong><div class='muted small'>${u.email} • ${u.role}</div>`;
      } else {
        document.getElementById('guest-actions').style.display='block';
        document.getElementById('user-box').style.display='none';
      }
    }

    // ---------- Hooks for buttons ----------
    document.getElementById('open-register').onclick = ()=>openRegisterModal();
    document.getElementById('open-login').onclick = ()=>openLoginModal();
    document.getElementById('btn-logout').onclick = ()=>{ logout(); alert('Logged out'); };
    document.getElementById('btn-dashboard').onclick = ()=>openDashboard();
    document.getElementById('cta-register').onclick = ()=>openRegisterModal();
    document.getElementById('cta-browse').onclick = ()=>{ document.getElementById('nav-courses').click(); }

    // Open register
    function openRegisterModal(){
      const html = `<h3>Register</h3>
        <div style='margin-top:8px'>
        <input id='reg-name' placeholder='Full name' />
        <input id='reg-email' placeholder='Email' style='margin-top:8px' />
        <select id='reg-role' style='margin-top:8px'>
          <option value='student'>Student</option>
          <option value='instructor'>Instructor</option>
        </select>
        <input id='reg-pass' type='password' placeholder='Password' style='margin-top:8px' />
        <div style='margin-top:10px'><button class='btn' id='btn-do-register'>Create account</button></div></div>`;
      const m = createModal(html);
      document.getElementById('modal-root').appendChild(m);
      m.querySelector('#btn-do-register').onclick = async ()=>{
        try{
          const name = m.querySelector('#reg-name').value; const email = m.querySelector('#reg-email').value; const role = m.querySelector('#reg-role').value; const pass = m.querySelector('#reg-pass').value;
          const u = await registerUser({name,email,password:pass,role});
          alert('Registered! Please login.'); m.remove();
        }catch(err){alert(err.message)}
      }
    }

    function openLoginModal(){
      const html = `<h3>Login</h3>
        <div style='margin-top:8px'>
        <input id='login-email' placeholder='Email' />
        <input id='login-pass' type='password' placeholder='Password' style='margin-top:8px' />
        <div style='margin-top:10px'><button class='btn' id='btn-do-login'>Login</button></div></div>`;
      const m = createModal(html);
      document.getElementById('modal-root').appendChild(m);
      m.querySelector('#btn-do-login').onclick = async ()=>{
        try{ const email=m.querySelector('#login-email').value; const pass=m.querySelector('#login-pass').value; const u = await loginUser(email,pass); alert('Welcome '+u.name); m.remove(); renderAccount(); }
        catch(e){ alert(e.message) }
      }
    }

    function openDashboard(){
      const u = currentUser(); if(!u) return alert('Please login');
      // dashboard content depends on role
      let html = `<h2>Dashboard — ${u.role}</h2><div style='margin-top:12px'>`;
      if(u.role==='student'){
        html += `<h4>Your Enrollments</h4><div id='student-enrolls'></div><h4 style='margin-top:12px'>Certificates</h4><div id='student-certs'></div>`;
      }
      if(u.role==='instructor'){
        html += `<button class='btn' id='create-course'>Create Course</button><div id='instructor-courses' style='margin-top:12px'></div>`;
      }
      if(u.role==='admin' || u.role==='superadmin'){
        html += `<h4>Manage Platform</h4><button class='btn' id='manage-users'>Manage Users</button><button class='btn' id='view-tx' style='margin-left:8px'>View Payments</button><div id='admin-area'></div>`;
      }
      if(u.role==='accountant'){
        html += `<h4>Transactions</h4><div id='acct-tx'></div>`;
      }
      html += `</div>`;
      const m = createModal(html, true); document.getElementById('modal-root').appendChild(m);

      // Fill role-specific data
      if(u.role==='student'){ renderStudentDashboard(m.querySelector('#student-enrolls'), m.querySelector('#student-certs'), u); }
      if(u.role==='instructor'){ renderInstructorDashboard(m.querySelector('#instructor-courses'), u); m.querySelector('#create-course').onclick = ()=>openCreateCourse(m); }
      if(u.role==='admin' || u.role==='superadmin'){ m.querySelector('#manage-users').onclick = ()=>openManageUsers(m); m.querySelector('#view-tx').onclick = ()=>openTransactions(m); }
      if(u.role==='accountant'){ renderTransactions(m.querySelector('#acct-tx')); }
    }

    function renderStudentDashboard(elEnrolls, elCerts, user){
      const tx = JSON.parse(localStorage.getItem(DB.TRANSACTIONS_KEY)||'[]');
      const myEnrolls = tx.filter(t=>t.userId===user.id && t.type==='enroll');
      elEnrolls.innerHTML = myEnrolls.length? myEnrolls.map(e=>`<div style='padding:8px;border:1px solid #eef2ff;border-radius:8px;margin-bottom:6px'>Course ID: ${e.courseId} • Enrolled: ${new Date(e.date).toLocaleDateString()} <button class='btn' style='margin-left:8px' onclick="completeCourse('${e.courseId}')">Mark Complete</button></div>`).join('') : '<div class="muted">No enrollments yet</div>';
      const certs = JSON.parse(localStorage.getItem(DB.CERTS_KEY)||'[]').filter(c=>c.userId===user.id);
      elCerts.innerHTML = certs.length? certs.map(c=>`<div style='padding:6px;border:1px solid #eef2ff;border-radius:6px;margin-bottom:6px'>${c.id} • ${new Date(c.issuedAt).toLocaleDateString()} <a href='${c.url}' target='_blank' class='btn' style='margin-left:8px'>Download</a></div>`).join('') : '<div class="muted">No certificates yet</div>';
    }

    function renderInstructorDashboard(el,user){
      const cs = getCourses().filter(c=>c.instructorId===user.id || c.instructorId===null);
      el.innerHTML = cs.map(c=>`<div style='padding:8px;border:1px solid #eef2ff;border-radius:8px;margin-bottom:6px'><strong>${c.title}</strong><div class='muted small'>${c.desc||''}</div><div style='margin-top:6px'><button class='btn' onclick="editCourse('${c.id}')">Edit</button></div></div>`).join('');
    }

    function openCreateCourse(parentModal){
      const content = `<h3>Create Course</h3>
        <input id='course-title' placeholder='Course title' />
        <textarea id='course-desc' placeholder='Short description' style='margin-top:8px'></textarea>
        <div style='margin-top:8px'><button class='btn' id='save-course'>Save Course</button></div>`;
      const m = createModal(content); document.getElementById('modal-root').appendChild(m);
      m.querySelector('#save-course').onclick = ()=>{
        const title = m.querySelector('#course-title').value; const desc = m.querySelector('#course-desc').value; const id='c_'+Date.now();
        const u = currentUser(); addCourse({id,title,desc,instructorId:u.id,lessons:[]}); m.remove(); renderCourses(); alert('Course created');
      }
    }

    function editCourse(courseId){
      const cs = getCourses(); const c = cs.find(x=>x.id===courseId);
      const html = `<h3>Edit ${c.title}</h3>
        <input id='edit-title' value='${escapeHtml(c.title)}' />
        <textarea id='edit-desc' style='margin-top:8px'>${escapeHtml(c.desc||'')}</textarea>
        <h4 style='margin-top:8px'>Lessons</h4>
        <div id='lessons-area'>${(c.lessons||[]).map(l=>`<div style='padding:6px;border:1px solid #eef2ff;border-radius:6px;margin-bottom:6px'><input value='${escapeHtml(l.title)}' data-id='${l.id}' class='lesson-title'/><textarea data-id='${l.id}' class='lesson-content' style='margin-top:6px'>${escapeHtml(l.content||'')}</textarea></div>`).join('')}</div>
        <div style='margin-top:8px'><input id='new-lesson-title' placeholder='New lesson title' /><textarea id='new-lesson-content' placeholder='Lesson content' style='margin-top:6px'></textarea><div style='margin-top:8px'><button class='btn' id='add-lesson'>Add Lesson</button></div></div>
        <div style='margin-top:10px'><button class='btn' id='save-edit'>Save</button></div>`;
      const m = createModal(html); document.getElementById('modal-root').appendChild(m);
      m.querySelector('#add-lesson').onclick = ()=>{
        const t = m.querySelector('#new-lesson-title').value; const ct = m.querySelector('#new-lesson-content').value;
        if(!t) return alert('Add title'); c.lessons.push({id:'l_'+Date.now(),title:t,content:ct}); saveCourses(cs); m.remove(); editCourse(courseId);
      }
      m.querySelector('#save-edit').onclick = ()=>{
        c.title = m.querySelector('#edit-title').value; c.desc = m.querySelector('#edit-desc').value;
        // update lessons from DOM
        const titles = m.querySelectorAll('.lesson-title'); titles.forEach(el=>{ const id=el.dataset.id; const l = c.lessons.find(x=>x.id===id); if(l) l.title = el.value; });
        const contents = m.querySelectorAll('.lesson-content'); contents.forEach(el=>{ const id=el.dataset.id; const l = c.lessons.find(x=>x.id===id); if(l) l.content = el.value; });
        saveCourses(cs); renderCourses(); alert('Saved'); m.remove();
      }
    }

    // Utility
    function escapeHtml(s){ return (s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;') }

    // Course flow: start and complete
    function startCourse(courseId){
      const cs = getCourses(); const c = cs.find(x=>x.id===courseId);
      if(!c) return alert('Course not found');
      const html = `<h3>${c.title}</h3>${(c.lessons||[]).map(l=>`<div style='padding:8px;border:1px solid #eef2ff;border-radius:6px;margin-bottom:6px'><h4>${l.title}</h4><p class='muted small'>${l.content||''}</p><button class='btn' onclick="completeLesson('${courseId}','${l.id}')">Mark Complete</button></div>`).join('')}`;
      const m = createModal(html); document.getElementById('modal-root').appendChild(m);
    }

    function completeLesson(courseId, lessonId){
      const u = currentUser(); if(!u) return alert('Login required');
      // track completion by saving to transactions as 'complete' for simplicity
      const tx = JSON.parse(localStorage.getItem(DB.TRANSACTIONS_KEY)||'[]');
      tx.push({id:'tx_'+Date.now(),userId:u.id,courseId,lessonId,type:'complete',date:new Date().toISOString()});
      localStorage.setItem(DB.TRANSACTIONS_KEY, JSON.stringify(tx));
      alert('Lesson marked complete');
    }

    async function completeCourse(courseId){
      const u = currentUser(); if(!u) return alert('Login required');
      const cs = getCourses(); const c = cs.find(x=>x.id===courseId);
      // For demo, assume course completed when user clicks 'complete'
      const result = await generateCertificate(u,c);
      alert('Certificate generated! You can download it in your dashboard.');
    }

    // Admin functions
    function openManageUsers(parent){
      const users = JSON.parse(localStorage.getItem(DB.USERS_KEY)||'[]');
      let html = `<h3>Users</h3><table><thead><tr><th>Name</th><th>Email</th><th>Role</th><th></th></tr></thead><tbody>`;
      html += users.map(u=>`<tr><td>${escapeHtml(u.name)}</td><td>${escapeHtml(u.email)}</td><td>${u.role}</td><td><button class='btn' onclick="changeRole('${u.id}')">Change Role</button></td></tr>`).join('');
      html += `</tbody></table>`;
      const m = createModal(html); document.getElementById('modal-root').appendChild(m);
    }
    function changeRole(userId){
      const users = JSON.parse(localStorage.getItem(DB.USERS_KEY)||'[]'); const u = users.find(x=>x.id===userId);
      const role = prompt('New role for '+u.email+' (student,instructor,admin,accountant,superadmin)', u.role);
      if(!role) return; u.role = role; localStorage.setItem(DB.USERS_KEY, JSON.stringify(users)); alert('Role updated');
    }

    function openTransactions(parent){
      const tx = JSON.parse(localStorage.getItem(DB.TRANSACTIONS_KEY)||'[]');
      const html = `<h3>Transactions</h3><div>${tx.map(t=>`<div style='padding:8px;border-bottom:1px solid #eef2ff'>${t.id} • ${t.method||t.type} • ${t.amount||'-'} • ${t.status||'ok'} • ${new Date(t.date).toLocaleString()}</div>`).join('')}</div>`;
      const m = createModal(html); document.getElementById('modal-root').appendChild(m);
    }
    function renderTransactions(el){
      const tx = JSON.parse(localStorage.getItem(DB.TRANSACTIONS_KEY)||'[]');
      el.innerHTML = tx.length? tx.map(t=>`<div style='padding:8px;border:1px solid #eef2ff;border-radius:8px;margin-bottom:6px'>${t.id} • ${t.method||t.type} • ${t.amount||'-'} • ${t.status||'ok'} • ${new Date(t.date).toLocaleString()}</div>`).join('') : '<div class="muted">No transactions</div>';
    }

    // Payment modal (simulate mobile money and Visa)
    function paymentModal(amount, courseId){
      const u = currentUser(); if(!u) return alert('Login first');
      const html = `<h3>Pay ${amount} for course</h3>
        <div style='margin-top:8px'>
        <select id='pay-method'><option value='orange'>Orange Liberia (Mobile Money)</option><option value='lonestar'>Lonestar (Mobile Money)</option><option value='mtn'>MTN Liberia (Mobile Money)</option><option value='visa'>Visa / Card</option></select>
        <input id='pay-phone' placeholder='Phone (for mobile money) or cardholder' style='margin-top:8px'/>
        <input id='pay-amount' placeholder='Amount' value='${amount}' style='margin-top:8px' />
        <div style='margin-top:8px'><button class='btn' id='do-pay'>Pay Now</button></div></div>`;
      const m = createModal(html); document.getElementById('modal-root').appendChild(m);
      m.querySelector('#do-pay').onclick = ()=>{
        const method = m.querySelector('#pay-method').value; const phone = m.querySelector('#pay-phone').value; const amt = m.querySelector('#pay-amount').value;
        const t = mockPayment({method,userId:u.id,amount:amt,phone});
        alert('Payment recorded (mock). Transaction ID: '+t.id);
        m.remove();
      }
    }

    // nav
    document.getElementById('nav-courses').onclick = (e)=>{ e.preventDefault(); document.querySelector('main').scrollIntoView(); }
    document.getElementById('nav-home').onclick = (e)=>{ e.preventDefault(); window.scrollTo({top:0,behavior:'smooth'}); }

    // startup
    (async()=>{ await ensureDefaults(); await renderCourses(); renderAccount(); })();
  </script>
</body>
</html>

